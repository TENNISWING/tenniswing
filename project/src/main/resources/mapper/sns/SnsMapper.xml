<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="com.tenniswing.project.community.mapper.SnsMapper">
  	<!-- 전체 조회  -->
  	<select id="selectAllSnsInfo" resultType="SnsVO">
  		select sns_wrt_no
  			   , sns_ctt
  			   , sns_write_date
  			   , sns_edit_date
  			   , sns_tag
  			   , sns_hit
  			   , mem_no
  			   , s.sns_grp_no
  			   , s.like_no
  			   , s.sns_grp_no
  		from sns s join sns_like l
        on s.like_no = l.like_no
        join sns_grp g
        on s.sns_grp_no = g.sns_grp_no
        join attach a
        on a.attach_table_pk = s.sns_wrt_no
        
  	</select>
  	
  	<!-- 단건조회 -->
  	<select id="selectSnsInfo" resultType="SnsVO">
		select sns_wrt_no
  			   , sns_ctt
  			   , sns_write_date
  			   , sns_edit_date
  			   , sns_tag
  			   , sns_hit
  			   , mem_no
  			   , s.sns_grp_no
  			   , s.like_no
  			   , s.sns_grp_no
  		from sns s join sns_like l
        on s.like_no = l.like_no
        join sns_grp g
        on s.sns_grp_no = g.sns_grp_no
        join attach a
        on a.attach_table_pk = s.sns_wrt_no
        where mem_no = #{memNo};
  		 <!-- LIKE '%' || #{keyword} || '%'
  		 	  LIKE '%${keyword}%'		   -->
  	</select>
  	
  	<!-- <if> => 조건이 true인 경우 -->
  	<!-- <foreach> => 반복문 : 배열로 넘어온 데이터 처리 --> 
	<!--
	<select id="selectPostIn" resultType="domain.blog.Post">
		SELECT *
		FROM POST P
		<where>
			<foreach item="item"(임시변수) index="index" collection="list" (배열)
				(처음 시작 값)open="ID in (" separator="," close=")" nullable="true">
				#{item}
			</foreach>
		</where>
	</select> 
	-->
  	<!-- <choose> => 다중 if문 -->
  	<!-- <trim> => 문장 구성 -->
  	
  	<!-- 등록 -->
  	<insert id="insertSns" parameterType="SnsVO">
  	 	<selectKey keyProperty="snsWrtNo" 
  	 			   resultType="int" 
  	 			   order="BEFORE">
  	 		<!-- primarykey가 숫자일 경우 사용 -->
  	 		SELECT NVL(MAX(sns_wrt_no), 0) + 1 
			FROM sns
  	 	</selectKey>
  	 	INSERT INTO sns
  	 			(
  	 				sns_wrt_no
  	 				,sns_title
  	 				,sns_ctt
  	 				,sns_tag
  	 				,mem_no
  	 				,snsHit
  	 				,sns_write_date
  	 			)
  	 			VALUES
  	 			(
  	 				#{snsWrtNo}
  	 				,#{snsTitle}
  	 				,#{snsCtt}
  	 				,#{snsTag}
  	 				,#{memNo}
  	 				,#{snsHit}
  	 				,#{snsWriteDate}
  	 				<choose>
  	 					<when test="snsWriteDate != null">,#{snsWriteDate}</when>
  	 					<otherwise>,sysdate</otherwise>
  	 				</choose>  	 				
  	 				
  	 			)
  	 			
  	</insert>
  	<!-- sns 그룹 등록 -->
  	<insert id="insertSnsGrp" parameterType="SnsVO">
  			<selectKey keyProperty="snsGrpNo" 
  	 			   resultType="int" 
  	 			   order="BEFORE">
  	 		<!-- primarykey가 숫자일 경우 사용 -->
  	 		SELECT NVL(MAX(sns_grp_no), 0) + 1 
			FROM sns_grp
  	 	</selectKey>
  	 		 	INSERT INTO sns_grp
  	 			(
  	 				sns_grp_no
  	 				,grp_create_date
  	 				,grp_name
  	 			)
  	 			VALUES
  	 			(
  	 				#{snsGrpNo}
  	 				<choose>
  	 					<when test="grpCreateDate != null">,#{grpCreateDate}</when>
  	 					<otherwise>,sysdate</otherwise>
  	 				</choose>  	
  	 				,#{grpName}
  	 				 				
  	 				
  	 			)
  	</insert>
  	
  	<!-- 수정 : 전제조건, 전체 데이터 전송 -->
  	<update id="updateSns" parameterType="SnsVO">
  		UPDATE employees
  			SET
  				first_name = #{firstName}
  			  , email = #{email}
  			  , salary = #{salary}
  		WHERE employee_id = #{employeeId}
  	</update>
  	
  	
  	<!-- 삭제 -->
  	<delete id="deleteSns" parameterType="int">
  		DELETE FROM employees
  		WHERE employee_id = #{empid} <!-- 기본타입으로 한건만 넘어올 경우 #에 다 집어넣어서 일치하지 않아도 됨 -->
  	</delete>
  </mapper>