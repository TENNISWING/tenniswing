<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/admin/admin-layout}">
<head>
	<link rel="shortcut icon" href="./assets/compiled/svg/favicon.svg"
		type="image/x-icon">
	<link rel="shortcut icon"
		href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAiCAYAAADRcLDBAAAEs2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjMzIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMzQiCiAgIGV4aWY6Q29sb3JTcGFjZT0iMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIzMyIKICAgdGlmZjpJbWFnZUxlbmd0aD0iMzQiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249Ijk2LjAiCiAgIHRpZmY6WVJlc29sdXRpb249Ijk2LjAiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgRGVzaWduZXIgMS4xMC4xIgogICAgICBzdEV2dDp3aGVuPSIyMDIyLTAzLTMxVDEwOjUwOjIzKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5V57uAAAABgmlDQ1BzUkdCIElFQzYxOTY2LTIuMQAAKJF1kc8rRFEUxz9maORHo1hYKC9hISNGTWwsRn4VFmOUX5uZZ36oeTOv954kW2WrKLHxa8FfwFZZK0WkZClrYoOe87ypmWTO7dzzud97z+nec8ETzaiaWd4NWtYyIiNhZWZ2TvE946WZSjqoj6mmPjE1HKWkfdxR5sSbgFOr9Ll/rXoxYapQVik8oOqGJTwqPL5i6Q5vCzeo6dii8KlwpyEXFL519LjLLw6nXP5y2IhGBsFTJ6ykijhexGra0ITl5bRqmWU1fx/nJTWJ7PSUxBbxJkwijBBGYYwhBgnRQ7/MIQIE6ZIVJfK7f/MnyUmuKrPOKgZLpEhj0SnqslRPSEyKnpCRYdXp/9++msneoFu9JgwVT7b91ga+LfjetO3PQ9v+PgLvI1xkC/m5A+h7F32zoLXug38dzi4LWnwHzjeg8UGPGbFfySvuSSbh9QRqZ6H+Gqrm3Z7l9zm+h+iafNUV7O5Bu5z3L/wAdthn7QIme0YAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAJTSURBVFiF7Zi9axRBGIefEw2IdxFBRQsLWUTBaywSK4ubdSGVIY1Y6HZql8ZKCGIqwX/AYLmCgVQKfiDn7jZeEQMWfsSAHAiKqPiB5mIgELWYOW5vzc3O7niHhT/YZvY37/swM/vOzJbIqVq9uQ04CYwCI8AhYAlYAB4Dc7HnrOSJWcoJcBS4ARzQ2F4BZ2LPmTeNuykHwEWgkQGAet9QfiMZjUSt3hwD7psGTWgs9pwH1hC1enMYeA7sKwDxBqjGnvNdZzKZjqmCAKh+U1kmEwi3IEBbIsugnY5avTkEtIAtFhBrQCX2nLVehqyRqFoCAAwBh3WGLAhbgCRIYYinwLolwLqKUwwi9pxV4KUlxKKKUwxC6ZElRCPLYAJxGfhSEOCz6m8HEXvOB2CyIMSk6m8HoXQTmMkJcA2YNTHm3congOvATo3tE3A29pxbpnFzQSiQPcB55IFmFNgFfEQeahaAGZMpsIJIAZWAHcDX2HN+2cT6r39GxmvC9aPNwH5gO1BOPFuBVWAZue0vA9+A12EgjPadnhCuH1WAE8ivYAQ4ohKaagV4gvxi5oG7YSA2vApsCOH60WngKrA3R9IsvQUuhIGY00K4flQG7gHH/mLytB4C42EgfrQb0mV7us8AAMeBS8mGNMR4nwHamtBB7B4QRNdaS0M8GxDEog7iyoAguvJ0QYSBuAOcAt71Kfl7wA8DcTvZ2KtOlJEr+ByyQtqqhTyHTIeB+ONeqi3brh+VgIN0fohUgWGggizZFTplu12yW8iy/YLOGWMpDMTPXnl+Az9vj2HERYqPAAAAAElFTkSuQmCC"
		type="image/png">
	
	<link rel="stylesheet"
		href="assets/extensions/datatables.net-bs5/css/dataTables.bootstrap5.min.css">
	<link rel="stylesheet"
		href="./assets/compiled/css/table-datatable-jquery.css">
	<style type="text/css">
	    svg,
	    path {
	       pointer-events: none;
	   }	
	   td{
	   		text-align: left;
	   }
	</style>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<th:block layout:fragment="admincontent">
	<!-- Main__container Start-->
	<div class="main__container">
		<!-- Main Inner Wrapper Start -->
		<div class="main__inner--wrapper" style="padding: 40px 0;">
			<!-- Product List Start -->
			<div class="row">
				<div class="col-12">
				<!-- 	<div class="dashboard__breadcrumb">
						<div class="breadcrumb__meta">
							<ul style="padding: 0">
								<li><a href="dashboard.html" class="link">Dashboard</a></li>
								<li>Calculation</li>
							</ul>
						</div>
					</div> -->
					<div class="dashboard__header">
						<div class="d__header--left">
							<h2 class="title">정산 리스트</h2>
						</div>
						<div class="add__btn" style="margin-right: 1.5rem">
							<button type="button" id="calcBtn" class="shop-btn shop-btn-primary"><i
								class="fas fa-plus"></i>정산하기</button>
						</div>
					</div>
					
					<!-- Basic Tables start -->
					<section class="section">
						<div class="card">
							<div class="card-body">
								<div class="table-responsive" style="height:669.531px">
									<table class="table" id="table1">
										<thead>
											<tr>
												<th>정산번호</th>
												<th>호스트ID</th>
												<th>호스트이름</th>
												<th>총 결제금액</th>
												<th>총 취소금액</th>
												<th>정산금액</th>
												<th>예금주</th>
												<th>은행</th>
												<th>입금계좌</th>
												<th>정산상태</th>
											</tr>
										</thead>
										<tbody id="calcTable">
											<th:block th:each="result : ${result}">
											<tr>
												<td style="width: 8%">[[${result.calcNo+1}]]</td>
												<td>[[${result.hostId}]]</td>
												<td>[[${result.hostName}]]</td>
												<td>
													<th:block th:if="${result.payPrice == 0}">
													[[${#numbers.formatInteger(result.payPrice, 1, 'COMMA') + '원'}]]
													</th:block>
													<th:block th:unless="${result.payPrice == 0}">
													[[${#numbers.formatInteger(result.payPrice, 3, 'COMMA') + '원'}]]
													</th:block>
												</td>
												<td>
													<th:block th:if="${result.cancelPrice == 0}">
													[[${#numbers.formatInteger(result.cancelPrice, 1, 'COMMA') + '원'}]]
													</th:block>
													<th:block th:unless="${result.cancelPrice == 0}">
													[[${#numbers.formatInteger(result.cancelPrice, 3, 'COMMA') + '원'}]]
													</th:block>
												</td>
												<td>
													<th:block th:if="${result.calcPrice == 0}">
													[[${#numbers.formatInteger(result.calcPrice, 1, 'COMMA') + '원'}]]
													</th:block>
													<th:block th:unless="${result.calcPrice == 0}">
													[[${#numbers.formatInteger(result.calcPrice, 3, 'COMMA') + '원'}]]
													</th:block>
												</td>
												<td style="width: 8%">[[${result.depositor}]]</td>
												<td style="width: 8%">[[${result.bank}]]</td>
												<td style="width: 12%">[[${result.accountNo}]]</td>
												<th:block th:if="${result.calcState} == 'bi1'">
													<td><span class="badge bg-success" style="background: rgba(105, 65, 198, 0.1) !important; color: #6941c6 !important;">정산예정</span></td>
												</th:block>
												<th:block th:unless="${result.calcState} == 'bi1'">
													<td><span class="badge bg-success" style="background: rgba(18, 183, 106, 0.1) !important; color: #12b76a !important;">정산완료</span></td>
												</th:block>
											</tr>
											</th:block>
										</tbody>
									</table>
								</div>
							</div>
						</div>

					</section>
					<!-- Basic Tables end -->

				</div>
			</div>
			<!-- Product List End -->
		</div>
		<!-- Main Inner Wrapper End -->
	</div>
	<!-- Main__container End-->
	
	<script th:inline="javascript">
	$('#calcBtn').on('click',function(e){
		let results = `[[${result}]]`;
		//results = JSON.parse(results)
		console.log(results);
		Swal2.fire({
			icon: "question",
			text: "일괄 정산하시겠습니까?",
			showDenyButton: true,
		    confirmButtonText: "yes",
		    denyButtonText: "no"
		}).then((result)=>{
			if(result.isConfirmed){
				$.ajax({
					url: 'admin_Calc_proccess',
					type: 'POST',
					contentType : 'application/json',
					data : results,
					success: function(result){
							Swal2.fire({
								icon: "success",
								text: "정산 완료되었습니다."
							}).then(function(){
								location.reload();
							})
							console.log(result);
					},
					error: function(err) {console.log(err)}
				})
			}
		})
	})
	/* $(function(){
		let today = new Date();

		let year = today.getFullYear();
		let month = ('0' + (today.getMonth())).slice(-2);
		
		let calcStartDate = year + '-' + month  + '-' + '01';
	
		console.log(calcStartDate);
		
		let calcDate = new Date(year,month,0);
		let day = calcDate.getDate();
		
		let calcEndDate = year + '-' + month + '-' + day;
		
		console.log(calcEndDate); */
		
		/* $.ajax({
			url: 'admin_Court_Calc_Ajax',
			method: 'get',
			data: {calcStartDate,
				   calcEndDate},
			success: function(results){
				for(let result of results){
				console.log(result.calcNo);
				let b = `
					<tr>
						<td>`+result.calcNo+`</td>
						<td>`+result.hostId+`</td>
						<td>`+result.hostName+`</td>
						<td>`+result.totalPayPrice+`</td>
						<td>`+result.cancelPrice+`</td>
						<td>`+result.calcPrice+`</td>
						<td>`+result.depositor+`</td>
						<td>`+result.bank+`</td>
						<td>`+result.accountNo+`</td>`
						if(result.calcState == 'bi1'){
							b+=`<td><span class="badge bg-success" >정산예정</span></td>`
						}
						else{
							b+=`<td><span class="badge bg-success" >정산완료</span></td>`
						}
						b+=`<td>
						<div class="card__action">
								<svg width="20"
									height="20" viewBox="0 0 20 20" fill="none"
									xmlns="http://www.w3.org/2000/svg">
                                    <g
										clip-path="url(#)">
                                        <path
										d="M0.833984 10C0.833984 10 4.16732 3.33334 10.0007 3.33334C15.834 3.33334 19.1673 10 19.1673 10C19.1673 10 15.834 16.6667 10.0007 16.6667C4.16732 16.6667 0.833984 10 0.833984 10Z"
										stroke="#667085" stroke-width="2"
										stroke-linecap="round" stroke-linejoin="round" />
                                        <path
										d="M10 12.5C11.3807 12.5 12.5 11.3807 12.5 10C12.5 8.61929 11.3807 7.5 10 7.5C8.61929 7.5 7.5 8.61929 7.5 10C7.5 11.3807 8.61929 12.5 10 12.5Z"
										stroke="#667085" stroke-width="2"
										stroke-linecap="round" stroke-linejoin="round" />
                                    </g>
                                    <defs>
                                        <clipPath>
                                            <rect
										width="20" height="20" fill="white" />
                                        </clipPath>
                                    </defs>
                                </svg>
							</div>
						</td>
					</tr>`
					$('#calcTable').append(b);
					}
				}
			})
		}) */
		/* function deleteProd(prodNo){
			console.log(prodNo);
			
			Swal.fire({
				title: "Are you sure?",
				text: "You won't be able to revert this!",
				icon: "warning",
				showCancelButton: true,
				confirmButtonColor: "#3085d6",
				cancelButtonColor: "#d33",
				confirmButtonText: "Yes, delete it!"
			}).then((result) => {
				//console.log(result);
				/* if (result.isConfirmed) {
					$.ajax({
						type : 'get', 
						url : 'adminDelete_Product?prodNo='+prodNo,
						contentType : 'application/json',
						dataType : 'text',
						success : function(data){
							data = JSON.parse(data);
							console.log(data.result);
							if(data.result){
								Swal.fire({
									icon: "success",
									title: "삭제 완료",
									text: "상품 정보가 삭제되었습니다.",
									}).then(function(){
										location.reload();
									})
							}else {
								Swal.fire({
									  icon: "error",
									  title: "삭제 실패",
									  text: "삭제 중 문제 발생",
								}).then(function(){
									location.reload();
								})
							}
						}
					});
				}
			});
		}
		
		changeColor();	
		function changeColor() {
			//console.log($('#table1 span').text());
			$('#table1 span').each((idx, item) => {
				//console.log(item);
				if($(item).text() == '판매중'){
					$(item).attr('style', 'background: rgba(18, 183, 106, 0.1) !important; color: #12b76a !important;');				
				} else {
					$(item).attr('style', 'background: transparent !important; border: 1px solid #fbd5ce !important; color: #eb5e28 !important');
				}
			})
		} */
	</script>
	<script src="assets/extensions/jquery/jquery.min.js"></script>
	<script
		src="assets/extensions/datatables.net/js/jquery.dataTables.min.js"></script>
	<script
		src="assets/extensions/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>
	<script src="assets/static/js/pages/datatables.js"></script>
</th:block>

</html>