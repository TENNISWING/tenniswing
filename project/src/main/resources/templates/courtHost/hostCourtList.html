<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layouts/main-layout}">
	
<head>
	<script src="sweetalert2.min.js"></script>
	<link rel="stylesheet" href="sweetalert2.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<link rel="stylesheet" href="assets/extensions/datatables.net-bs5/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="./assets/compiled/css/table-datatable-jquery.css">
</head>

<th:block layout:fragment="content">
	<div class="container">
		<!-- Basic Tables start -->
    <section class="section">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    Court List
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table" id="table1">
                        <thead>
                            <tr>
                            	<th>Court No</th>
                                <th>image</th>
                                <th>Name</th>
                                <th>Location</th>
                                <th>Operate Time</th>
                                <th>Court Count</th>
                                <th>Register Date</th>
                                <th>Button</th>
                            </tr>
                        </thead>
                        <tbody>
                        	<th:block th:each="courtList, stat : ${courtList}">
	                            <tr>
	                            	<td id="crtroomNo" th:attrappend="id=${stat.index}">[[ ${courtList.crtroomNo} ]]</td>
	                                <td></td>
	                                <td>[[ ${courtList.crtroomName} ]]</td>
	                                <td>[[ ${courtList.crtroomLocation} ]]</td>
	                                <td>[[ ${courtList.crtroomOperateStartTime} ]] ~ [[ ${courtList.crtroomOperateEndTime} ]]</td>
	                                <td>[[ ${courtList.crtCount} ]]</td>
	                                <td>[[ ${#dates.format(courtList.crtroomRegiDate,'yyyy년MM월dd일')} ]]</td>
	                                <td>
	                                	<div th:onclick="|location.href='@{/hostCourtDetail(crtroomNo=${courtList.crtroomNo})}'|" class="btn icon btn-primary"><i class="icon dripicons dripicons-enter"></i></div>
	                           			<div class="btn icon btn-success"><i class="icon dripicons dripicons-pencil"></i></div>
										<div class="btn icon btn-danger courtroom" id="courtroomDelete" th:attrappend="id=${stat.index}"><i class="icon dripicons dripicons-trash"></i></div>
	                                </td>
	                            </tr>
                            </th:block>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>
    <!-- Basic Tables end -->
	</div>
	<script th:inline="javascript">
	$('.courtroom').on('click',function(e){
		
		Swal.fire({
			  title: "",
			  text: "정말 삭제하시겠습니까?",
			  icon: "warning",
			  showCancelButton: true,
			  confirmButtonColor: "#3085d6",
			  cancelButtonColor: "#d33",
			  confirmButtonText: "Yes, delete it!"
			}).then((result) => {
			  if (result.isConfirmed) {
			    console.log($(e.target));
				let cnt = $(e.target).prop("id").replace("courtroomDelete","");
				console.log(cnt);
				let courtroomNo = Number($('#crtroomNo'+cnt).text());
				$.ajax({
					type: 'POST',
					url: 'deleteCourtroom',
					data: {crtNo: courtroomNo},
					dataType: 'json',
					success: function(result){
						if(result){
							Swal.fire({
								  icon: "success",
								  title: "",
								  text: "정상적으로 삭제되었습니다.",
								}).then(function(){
									location.reload();
								})
						}else{
							Swal.fire({
								  icon: "error",
								  title: "",
								  text: "정상적으로 삭제되지 않았습니다. \n정보를 확인해주시기바랍니다.",
								})
						}
					}
				})
		  	}
		});
	})
		/* let msg = [[${result}]]
		if(msg != null) alert(msg); */
	</script>
	<script src="assets/extensions/jquery/jquery.min.js"></script>
	<script src="assets/extensions/datatables.net/js/jquery.dataTables.min.js"></script>
	<script src="assets/extensions/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>
	<script src="assets/static/js/pages/datatables.js"></script>
</th:block>
</html>