<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/main-layout}">
<th:block layout:fragment="content">
	<!-- match sub menu -->
	<div class="container mb-4">
		<ul class="nav d-flex justify-content-around text-center matchsidevar">
			<li class="d-flex flex-column"><a href="/"><img
					src="assets/img/match/icon/icon1.png" class=" miconimg">매치</a></li>
			<li class="d-flex flex-column"><a href="clubmatch"><img
					src="assets/img/match/icon/icon2.png" class=" miconimg">클럽</a></li>
			<li class="d-flex flex-column"><a href="contestmatch"><img
					src="assets/img/match/icon/icon3.png" class=" miconimg">대회</a></li>
			<li class="d-flex flex-column"><a href="startermatch"><img
					src="assets/img/match/icon/icon4.png" class=" miconimg">스타터</a></li>
		</ul>
	</div>
	<!-- End match sub menu  -->

	<!-- slide banner -->
	<div class="container-fluid mb-2 bg-light-info">
		<div class="container pt-3 pb-3">
			<div class="swiper mySwiper banner" data-aos="fade-up">
				<div class="swiper-wrapper banner">
					<div class="swiper-slide banner text-center">
						<img src="/assets/img/match/slide.png" class="img-fluid" alt="">
					</div>
					<div class="swiper-slide banner text-center">
						<img src="/assets/img/match/slide.png" class="img-fluid" alt="">
					</div>
				</div>
				<div class="swiper-pagination banner"></div>
			</div>
		</div>
	</div>
	<!-- End slide banner -->

	<!-- date slide -->
	<div class="container mt-3 mb-5">
		<!-- Swiper -->
		<div class="swiper mySwiper dateslide">
			<div class="swiper-wrapper dateslide matchdate">
				<!-- <div class="swiper-slide dateslide">resizeme</div>            -->
			</div>
			<div class="swiper-button-next dateslide text-green"></div>
			<div class="swiper-button-prev dateslide text-green"></div>

		</div>
	</div>
	<!-- End date slide -->

	<div class="container">
		<div class="row align-items-center">
			<div class="col-12">
				<div class="filter__area">
					<div class="section-title__wrap">
						<!-- 필터처리 -->
						<form action="#" class="product-filter">
							<!-- 카테고리 form-select select__style -->
							<div class="select__style" id="firstDrop">
								<select class="category-select" id="gameWay" name="gameWay">
									<option value="">게임방식</option>
									<option value="f1">단식</option>
									<option value="f2">남복</option>
									<option value="f3">여복</option>
									<option value="f4">랠리</option>
									<option value="f5">혼복</option>
								</select>
							</div>
							<!-- 성별 -->
							<div class="select__style" id="secondDrop">
								<select id="gen" name="gen" class="category-select">
									<option value="">성별</option>
									<option value="c1">남자</option>
									<option value="c2">여자</option>
								</select>
							</div>
							<div class="select__style" id="secondDrop">
								<select id="crtroomLocation" name="crtroomLocation"
									class="category-select">
									<option value="">지역</option>
									<option value="b1">서울</option>
									<option value="b2">경기</option>
									<option value="b3">인천</option>
									<option value="b4">강원도</option>
									<option value="b5">전라도</option>
									<option value="b6">경상도</option>
									<option value="b7">충청도</option>
									<option value="b8">제주도</option>
								</select>
							</div>
							<button type="button" id="btnreset" class="danger__btn border-30"
								style="background: rgba(18, 183, 106, 0.1) !important; color: #12b76a !important;">초기화</button>
						</form>
					</div>
						<div class="col-lg-2 text-end">
							<button type="button" class="btn btn-primary"
								th:onclick="|location.href='@{matchregi}'|">매치 등록</button>
						</div>
				</div>
			</div>
		</div>

		<!-- Default Table -->
		<table class="table">
			<thead>
				<tr>
					<th>날짜</th>
					<th>경기 시간</th>
					<th>경기 방식</th>
					<th>모집 성별</th>
					<th>코트장 이름</th>
					<th>지역</th>
					<th>모집 상태</th>
				</tr>
			</thead>
			<tbody id="matchList">

			</tbody>
		</table>
		<div class="container mt-5 mb-5">
			<ul class="pagination justify-content-center">
			</ul>
		</div>
	</div>
	<!-- End match table -->

	<!-- 하단 상품 슬라이드 -->
	<section class="trending__section pt-0">
		<div class="container">
			<div class="row">
				<div class="col-12">
					<div class="section-title">
						<h5 style="color: black">최근 등록된 매치</h5>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-12">
					<div class="product__wrapper swiper__pagination">
						<div class="swiper trending__Swiper">
							<div class="swiper-wrapper">

								<div th:block th:each="v : ${viewList}" class="swiper-slide">
									<div class="product-card">
										<div class="product__image__wrapper">
											<a
												th:onclick="|location.href='@{matchdetail(matchNo=${v.matchNo})}'|"
												class="product__image"> <img th:src="${v.attachPath}"
												alt="icon" />
											</a>
										</div>
										<div class="product__content">
											<!-- <div class="product__rating">
												<ul style="padding: 0">
													<li><i class="fa-solid fa-star"></i></li>
													<li><i class="fa-solid fa-star"></i></li>
													<li><i class="fa-solid fa-star"></i></li>
													<li><i class="fa-solid fa-star"></i></li>
													<li><i class="fa-regular fa-star"></i></li>
												</ul>
												<div class="total__rating">(321)</div>
											</div> -->
											<!-- 상품명 -->
											<div class="product__title">
												<h5>
													<a href="product-single.html">[[ ${v.crtroomName} ]]</a>
												</h5>
											</div>
											<div class="product__bottom">
												<div class="cart__action__btn">
													<div class="cart__btn">
														<a
															th:onclick="|location.href='@{matchdetail(matchNo=${v.matchNo})}'|"
															class="btn btn-outline"> 상세보기</a>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>

							</div>

							<div class="swiper-button-next">
								<svg width="35" height="16" viewBox="0 0 35 16" fill="none"
									xmlns="http://www.w3.org/2000/svg">
                                           <path d="M1 8L34 8"
										stroke="#D0D5DD" stroke-width="2" stroke-linecap="round"
										stroke-linejoin="round" />
                                           <path d="M27 1L34 8L27 15"
										stroke="#D0D5DD" stroke-width="2" stroke-linecap="round"
										stroke-linejoin="round" />
                                       </svg>
							</div>
							<div class="swiper-button-prev">
								<svg width="23" height="16" viewBox="0 0 23 16" fill="none"
									xmlns="http://www.w3.org/2000/svg" style="width: 85%">
                                        <path d="M22 8H1"
										stroke="#D0D5DD" stroke-width="2" stroke-linecap="round"
										stroke-linejoin="round" />
                                        <path d="M8 15L1 8L8 1"
										stroke="#D0D5DD" stroke-width="2" stroke-linecap="round"
										stroke-linejoin="round" />
                                    </svg>
							</div>
							<!-- <div class="swiper-slide"></div> -->
							<div class="swiper-pagination"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- 슬라이드 닫히는 곳 -->

	<script>
	$('#btnsearch').on("click", function(e) {
		let matchDate = $('.matchdate .active').data('day');
		matchAjax(matchDate,1)
	})
	
	function dateFormat(dd) {
		let date = new Date(dd);
        let month = date.getMonth() + 1;
        let day = date.getDate();
        let hour = date.getHours();
        let minute = date.getMinutes();
        let second = date.getSeconds();

        month = month >= 10 ? month : '0' + month;
        day = day >= 10 ? day : day;
        hour = hour >= 10 ? hour : '0' + hour;
        minute = minute >= 10 ? minute : '0' + minute;
        second = second >= 10 ? second : '0' + second;

        //date.getFullYear() + '-' + month + '-' + day;
        return month + '월 ' + day + '일';
}
				 
	function matchAjax(matchDate,page) {
		let gameWay = $('#gameWay').val();		
		let gen = $('#gen').val();
		let crtroomLocation = $('#crtroomLocation').val();
		let ntrp = $('#ntrp').val();
		 
		$.ajax({
			type: 'GET',
			url: 'matchList',
			data: {matchDate, page, gameWay, gen, crtroomLocation, ntrp},
			success: function(result) {
				//리스트
				$('#matchList').empty();
				for(let matchInfo of result.matchList){				
					let b = `<tr class="navbar-brand">					
					<td class="text-center"><b>${dateFormat(matchInfo.matchDate)}</b></td>
					<td>${matchInfo.time}시</td>
					<td>${matchInfo.gameWayName}</td>
					<td>${matchInfo.genName}</td>
					<td>${matchInfo.crtroomName}</td>
					<td>${matchInfo.crtroomLocation}</td>
					<td class="text-end mtbt">`					
					if (matchInfo.progStateName=='마감'){
					b += `<a class="btn btn-secondary disabled matchbtn2" href="matchdetail?matchNo=${matchInfo.matchNo}">${matchInfo.progStateName}</a>`
					} else {
					b += `<a class="btn btn-primary matchbtn1" href="matchdetail?matchNo=${matchInfo.matchNo}">${matchInfo.progStateName}</a>`
					}
					b += '</td></tr>'
					$('#matchList').append(b)
				}
				
				showPage(result.selectCount);
			}
		})
	}
	
	$('.pagination').on("click","li a", function(e) {
		
		e.preventDefault();
		console.log("page click");
		
		var targetPageNum = $(this).attr("href");
		
		console.log("targetPageNum: " + targetPageNum);
		
		pageNum = targetPageNum;
		
		matchAjax(matchDate,targetPageNum);
	
	});
	
	pageNum = 1;
	pageSize = 10.0; //페이지 번호 수
	pageUnit = 5;  //한페이지에 출력할 행의 수
	// 페이징
	function showPage(replyCnt) {
		
		var endNum = Math.ceil(pageNum / pageSize) * pageSize;
		var startNum = endNum > pageSize? endNum - pageSize : 1;
		
		var prev = startNum != 1;
		var next = false;
		
		if(endNum * 10 >= replyCnt) {
			endNum = Math.ceil(replyCnt/pageUnit);
		}
		
		if(endNum * 10 < replyCnt) {
			next = true;
		}
		
		var str= "";
		
		if(prev) {
			str+= "<li class='page-item'><a class='page-link' href='"+(startNum -1)+"'>Previous</a></li>";
		}
		
		for(var i = startNum ; i <= endNum; i++) {
			var active = pageNum == i? "active":"";
			str+= "<li class='page-item "+active+"'> <a class='page-link' href='"+i+"'>"+i+"</a></li>";		
		}
		
		if(next) {
			str+= "<li class='page-item'><a class='page-link' href='"+(endNum + 1)+"'>Next</a><li>";
		}
		
		str += "";
		
		console.log(str);
		
		$('.pagination').html(str);
	}
	
	 

                        var swiper = new Swiper(".mySwiper.dateslide", {            

                            direction : getDirection(),
                            on: {
                                resize: function () {
                                swiper.changeDirection(getDirection());
                                },
                            },
                            pagination: {
                                el: ".swiper-pagination.dateslide",                         
                            },
                            navigation: {
                                nextEl: ".swiper-button-next.dateslide",
                                prevEl: ".swiper-button-prev.dateslide",
                            },
                            breakpoints: {
                                320: {
                                    slidesPerView: 5,
                                },
                                480: {
                                    slidesPerView: 5,
                                },
                                640: {
                                    slidesPerView: 5,
                                },
                                992: {
                                    slidesPerView: 7,
                                }
                            }
                        });

                        function getDirection() {
                            var windowWidth = window.innerWidth;
                            var direction = window.innerWidth <= 760 ? 'vertical' : 'horizontal';
                            return direction;
                        }

                        const days = ["일", "월", "화", "수", "목", "금", "토"];
                        let today = new Date();
                        let dateGetDay = today.getDay();
                        let year = today.getFullYear();
                        let month = today.getMonth();
                        let dateGetDate = today.getDate();
                        let dateArry = [];
						let matchDate = year+"-"+(month+1)+"-"+dateGetDate
						matchAjax(matchDate,1)
                        
                        for (let i = 0; i < 14; i++) {
                        	let weekName = (dateGetDay+i)%7;
                        	let day = new Date(year,month,dateGetDate + i)
                            dateArry.push({
                            	"dayNo": weekName,
                                "day": days[weekName],
                                "date": day.getDate(),
                                "allDate": day.getFullYear()+"-"+(day.getMonth()+1)+"-"+day.getDate()
                            })
 
                        }
                    
                        $.each(dateArry, (idx, ele) => {
                        	console.log(ele.dayNo);
                        	if (idx == 0) {
                                $('.swiper-wrapper.dateslide').append(`<div class="swiper-slide dateslide text-center">
                                                    <div class="btn btn-outline-success active" data-day="${ele.allDate}">
                                                    ${ele.date}<br>
                                                    ${ele.day}</div></div>`)
                            } else if (ele.dayNo == 0) {
                        		 $('.swiper-wrapper.dateslide').append(`<div class="swiper-slide dateslide text-center">
                                         <div class="btn btn-outline-danger" data-day="${ele.allDate}">
                                         ${ele.date}<br>
                                         ${ele.day}</div></div>`)
                        	} else if (ele.dayNo == 6) {
                        		 $('.swiper-wrapper.dateslide').append(`<div class="swiper-slide dateslide text-center">
                                         <div class="btn btn-outline-primary" data-day="${ele.allDate}">
                                         ${ele.date}<br>
                                         ${ele.day}</div></div>`)
                        	} else {
                        		$('.swiper-wrapper.dateslide').append(`<div class="swiper-slide dateslide text-center">
                                        <div class="btn btn-outline-success" data-day="${ele.allDate}">
                                        ${ele.date}<br>
                                        ${ele.day}</div></div>`)
                        	}
                        	
                        })
                        $('.swiper-wrapper.dateslide > div div').on('click', function (e) {
                        	$('.swiper-wrapper.dateslide > div div').removeClass('active');
                        	$(e.target).toggleClass('active');
                        	let matchDate = $(e.target).data('day');
                        	matchAjax(matchDate,1);
                        	
                            //태그네임 가져오기                 
                            //console.log($(e.target).prop('tagName'))
                            //$('.swiper-wrapper.dateslide > div div').attr('class', 'text-dark')
                            //$(e.target).attr('class','bg-green rounded-pill text-white');
                            // $(e.target).attr('class','bg-green rounded-pill text-white');                           
                            // $(e.target)
                            // if ($(e.target).prop('tagName') == 'A') {                                
                            //     $('.swiper-wrapper.dateslide a').attr('class', 'link-dark');
                            //     $(e.target).parent().attr('class', 'bg-green rounded-pill');
                            //     $(e.target).attr('class', 'text-white');
                            // }else if ($(e.target).prop('tagName') == 'DIV') {                                
                            //     $('.swiper-wrapper.dateslide a').attr('class', 'link-dark');
                            //     $(e.target).attr('class', 'bg-green rounded-pill');
                            //     $(e.target).children().attr('class', 'text-white');
                            // }else{}
                        })
                        
                        
                        
                        new Swiper(".mySwiper.mtbanner", {
							/* loop : true, */
							loopPreventsSliding : true,
							grabCursor : true,
							slidesPerView : 3,
							spaceBetween : 20,

							/* autoplay : {
								delay : 2000,
								pauseOnMouseEnter : true,
								disableOnInteraction : false
							}, */
							pagination : {
								el : ".swiper-pagination.mtbanner",
								dynamicBullets : true,
								clickable : true,
							},
						});
                        
                                                
                        
                        new Swiper(".mySwiper.banner", {
                            loop: true,
                            loopPreventsSliding: true,
                            grabCursor: true,
                            autoplay: {
                                delay: 2000,
                                pauseOnMouseEnter: true,
                                disableOnInteraction: false
                            },
                            pagination: {
                                el: ".swiper-pagination.banner",
                                dynamicBullets: true,
                                clickable: true,
                            },
                        });
                    </script>
</th:block>

</html>