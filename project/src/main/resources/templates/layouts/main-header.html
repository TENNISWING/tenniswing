<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<style type="text/css">
	svg, path, span {
		pointer-events: none;
	}
</style>
<th:block th:fragment="header">
	<!-- header -->
	<header class="mb-4">
		<div class="header-top">
			<div class="container">
				<div class="logo">
					<a href="/">
						<h3>
							<i class="fa-solid fa-baseball"></i>TennisWing.
						</h3>
					</a>
				</div>
				<div class="header-top-right">
					<!-- 코트 찾기 -->
					
					<div class="input-group">
						<input type="text" class="form-control" autocomplete="off"
							placeholder="코트 찾기" data-bs-toggle="collapse"
							data-bs-target="#collapseExample" aria-expanded="false"
							aria-controls="collapseExample" id="search">
							
						<button type="button" class="input-group-text">
							<i class="icon dripicons dripicons-search fs-3"></i>
						</button>
						<div class="collapse z-3 position-absolute mt-5" id="searchArea">
							
								<div class="form-group">
                                        <select class="choices form-select" id="searchItem">
                                           
                                        </select>
                                    </div>
						
						</div>
					</div>
					
					<script>
						$('#search').on('propertychange change keyup paste input', function(e){
						
								let inputVal = $(e.target).val();
								
								$('#searchArea').addClass('show');								
				
								 $.ajax({
								        type: 'get',
								        url: 'searcharea',
								        data: {inputVal},
								        success: function (result) {
								        	$('#searchItem').empty();
								        	$('#searchItem').append('<optgroup label="코트">');
								        	$.each(result, function(index, data) { // 데이터 =item
								        		let b = `													 
					                                 <option value="${data.crtroomNo}">${data.crtroomName}</option>  `  										
					                                 $('#searchItem').append(b)												
											});								        	
												b = '</optgroup>'
											$('#searchItem').append(b)
								        },
								        error: () => console.log(error)
								    })
								
								if(inputVal == ''){
									$('#searchArea').removeClass('show');
								}
							
							
						})
					</script>
					<!-- <a href="cart" class="cart__btn">
								<div class="icon dripicons dripicons-cart text fs-3"></div>
								</a> -->
					<div class="miniCart">
						<div class="header__cart" style="margin: 0px;">
							<a href="#" class="cart__btn myCart"> <!-- <div class="cart__btn-img" style="margin: 0">
									<img src="assets/img/shop/cart-icon.png" alt="cart-icon" />
									<span class="value">10</span>
								</div> -->
								<div class="icon dripicons dripicons-cart text fs-3"></div>
							</a>
						</div>
					</div>
					<a href="mypage">
						<div class="icon dripicons dripicons-user fs-3"></div>
					</a> <a href="javascirpt:void(0)" class="burger-btn d-block d-xl-none">
						<div class="icon dripicons dripicons-menu fs-3"></div>
					</a>
				</div>
			</div>
		</div>

		<!-- 네비 -->
		<nav class="main-navbar">
			<div class="container">
				<ul>
					<li class="menu-item has-sub"><a href="/" class="menu-link">
							<span>소셜매치</span>
					</a>
						<div class="submenu">
							<div class="submenu-group-wrapper">
								<ul class="submenu-group">
									<li class="submenu-item"><a href="/" class='submenu-link'>매치</a></li>
									<li class="submenu-item  "><a href="clubmatch"
										class='submenu-link'>클럽</a></li>
									<li class="submenu-item  "><a href="contestmatch"
										class='submenu-link'>대회</a></li>
									<li class="submenu-item  "><a href="startermatch"
										class='submenu-link'>스타터</a></li>
								</ul>
							</div>
						</div></li>
					<li class="menu-item"><a href="court" class='menu-link'> <span>코트예약</span></a>
					</li>

					<li class="menu-item has-sub"><a href="club" class="menu-link">
							<span>클럽</span>
					</a>
						<div class="submenu">
							<div class="submenu-group-wrapper">
								<ul class="submenu-group">
									<li class="submenu-item"><a href="club"
										class='submenu-link'>클럽목록</a></li>
									<li class="submenu-item"><a href="clubform"
										class='submenu-link'>클럽창설</a></li>
									<li class="submenu-item"><a href="myclub"
										class='submenu-link'>마이클럽</a></li>
								</ul>
							</div>
						</div></li>

					<li class="menu-item has-sub"><a href="sns" class="menu-link">
							<span>커뮤니티</span>
					</a>
						<div class="submenu">
							<div class="submenu-group-wrapper">
								<ul class="submenu-group">
									<li class="submenu-item"><a href="sns"
										class='submenu-link'>SNS</a></li>
									<li class="submenu-item"><a href="freeboardList"
										class='submenu-link'>자유게시판</a></li>
									<li class="submenu-item"><a href="noticeList"
										class='submenu-link'>공지사항</a></li>
								</ul>
							</div>
						</div></li>

					<li class="menu-item"><a href="shop" class="menu-link"> <span>쇼핑</span>
					</a> <!-- <div class="submenu">
                                    <div class="submenu-group-wrapper">
                                        <ul class="submenu-group">
                                            <li class="submenu-item">
                                                <a href="shop" class='submenu-link'>쇼핑몰</a>
                                            </li>
                                            <li class="submenu-item">
                                                <a href="swingmarket" class='submenu-link'>스윙마켓</a>
                                            </li>
                                        </ul>
                                    </div>
                          		 </div> --></li>
				</ul>
			</div>
		</nav>
	</header>
	<!-- End header -->

	<!-- Header FlyoutCart Start 카트 시작 -->
	<div class="flyoutCart">
		<div class="flyout__flip">
			<div class="flyout__inner">
				<div class="cart__header-top">
					<div class="main__title">장바구니</div>
					<div class="close__btn action__btn">
						<svg width="24" height="24" viewBox="0 0 24 24" fill="none"
							xmlns="http://www.w3.org/2000/svg">
							<path d="M18 6L6 18" stroke="#344054" stroke-width="2"
								stroke-linecap="round" stroke-linejoin="round" />
							<path d="M6 6L18 18" stroke="#344054" stroke-width="2"
								stroke-linecap="round" stroke-linejoin="round" />
						</svg>
						<!-- Close -->
					</div>
				</div>
				<div class="cart__title">
					<h3>상품 목록</h3>
					<h3>상품 금액</h3>
				</div>
				<div class="cart__items" id="cartList">
					<!-- Shopping Cart Item Start -->

					<!-- Shopping Cart Item End -->
				</div>
				<!-- Cart Items End -->
				<!-- Cart SubTotal Start -->
				<ul class="cart__subtotal" style="border-top: none;">
					<!-- <li>
						<span class="label">Subtotal</span> <span class="value">$45.00</span>
					</li>
					<li><span class="label">Shipping:</span> <span class="value">$15.22</span>
					</li> -->
				</ul>
				<!-- Cart SubTotal End -->
				<!-- Total Start -->
				<div class="cart__total">
					<h3>
						결제금액 <span>(Incl. VAT)</span>
					</h3>
					<div class="total">$60.22</div>
				</div>
				<!-- Total End -->
			</div>
			<!-- Cart Button Start -->
			<div class="cart__btns">
				<a href="checkout" class="btn btn-primary">상품 주문</a> <a
					href="#" class="btn btn-outline" style="border: 1px solid">쇼핑 하기</a>
			</div>
			<!-- Cart Button End -->
		</div>
	</div>
	<!-- Header FlyoutCart End 카트 종료 -->
	
	<!-- 장바구니 로그인 체크 -->
	<script th:inline="javascript">
	$('.myCart').on('click', function(event){
		event.preventDefault();
		$(".flyoutCart").toggleClass("active");
		//$('.flyoutCart').removeClass('active');
		let cartMemId = [[${#authentication.name}]];
		console.log(cartMemId);
		if(cartMemId == "anonymousUser"){
			Swal.fire({
				title: "로그인 확인",
				html: `로그인이 필요한 서비스입니다.<br>
					   로그인 페이지로 이동하시겠습니까?`,
				icon: "warning",
				showCancelButton: true,
				confirmButtonColor: "#3085d6",
				cancelButtonColor: "#d33",
				confirmButtonText: "이동",
				cancelButtonText: "취소"
			}).then((result) => {
				  if (result.isConfirmed) {
				    location.href = '/loginform';
				    return;
				  }
			})
		} else {
			$.ajax('selectCartList', {
				type: 'get',
		        data: {cartMemId},		
			})
			.done(result => {
				console.log(result);
				$('#cartList').empty();
				for(let cart of result) {
					let cartData = `<div class="shopping-card">
										<a href="shopDetail?prodNo=${cart.prodNo}" class="shopping-card__image"> 
											<img src="${cart.attachPath}" alt="cart-product" />
										</a>
										<div class="shopping-card__content">
											<div class="shopping-card__content-top">
												<h5 class="product__title">
													<a href="shopDetail?prodNo=${cart.prodNo}"><b>${cart.prodName}</b></a>
												</h5>
												<h5 class="product__price cartPrice" id="cartPrice${cart.cartNo}">${cart.prodPrice}</h5>
											</div>
											<div class="shopping-card__content-top" id="soldOut">
												<p style="margin: 0 0 9px 3px; color: #344054;">[color]${cart.cateColor} [size]${cart.cateSize}</p>
											</div>
											<div class="shopping-card__content-bottom">
												<div class="quantity__wrapper">
													<div class="quantity">
														<button type="button" class="decressQnt" id="checkCartDown${cart.cartNo}">
															<span class="bar"></span>
														</button>
														<input class="qnttinput" type="number" value="${cart.cartProdQt}" id="prodCartDetailSto${cart.cartNo}"
															min="0" max="${cart.prodDetailSto}" readonly="readonly" />
														<button type="button" class="incressQnt" id="checkCartCount${cart.cartNo}">
															<span class="bar"></span>
														</button>
													</div>
												</div>
												<button type="button" class="action__btn" id="deleteCartBtn" style="padding-right: 0;">
													<svg width="16" height="16" viewBox="0 0 16 16" fill="none"
														xmlns="http://www.w3.org/2000/svg">
														<path
															d="M1.25 3.5H2.75M2.75 3.5H14.75M2.75 3.5V14C2.75 14.3978 2.90804 14.7794 3.18934 15.0607C3.47064 15.342 3.85218 15.5 4.25 15.5H11.75C12.1478 15.5 12.5294 15.342 12.8107 15.0607C13.092 14.7794 13.25 14.3978 13.25 14V3.5H2.75ZM5 3.5V2C5 1.60218 5.15804 1.22064 5.43934 0.93934C5.72064 0.658035 6.10218 0.5 6.5 0.5H9.5C9.89782 0.5 10.2794 0.658035 10.5607 0.93934C10.842 1.22064 11 1.60218 11 2V3.5M6.5 7.25V11.75M9.5 7.25V11.75"
															stroke="#667085" stroke-linecap="round"
															stroke-linejoin="round" />
													</svg>
													<span>삭제</span>
												</button>
											</div>
										</div>
									</div>`;
					$('#cartList').append(cartData);
				}
				changeCartPrice();
				$(".incressQnt").on("click", function () {
			        var $qty = $(this).closest("div").find(".qnttinput");
			        var currentVal = parseInt($qty.val(), 10);
			        if (!isNaN(currentVal)) {
			            $qty.val(currentVal + 1);
			        }
			    });
			    $(".decressQnt").on("click", function () {
			        var $qty = $(this).closest("div").find(".qnttinput");
			        var currentVal = parseInt($qty.val(), 10);
			        if (!isNaN(currentVal) && currentVal > 0) {
			            $qty.val(currentVal - 1);
			        } else {
			            $(this).parents(".cart__action__btn").find(".cart__quantity").css("display", "none");
			        }
			    });
			    
			    $('span').css('pointer-events', 'none');
			    checkAllProd();
			})
			.fail(err => console.log(err));
			
			$(".flyoutCart").toggleClass("active");
		}
	});
	
	/* 최대 재고 체크 */
	function checkAllProd() {
		checkCountProd();
		let allSto = $('.incressQnt');
		let downSto = $('.decressQnt');
		
		allSto.each(function() {
			let maxId = $(this).attr('id');
			//console.log(maxId);
			
			$('#'+maxId).on('click', function(e) {
				//console.log(e.target.parentElement.children[1].value);
				let stoInput = e.target.parentElement.children[1];
				console.log($(stoInput).attr('max'));
				if(e.target.parentElement.children[1].value == $(stoInput).attr('max'))
		    		$('#'+maxId).attr('disabled', true);
			})
		});
		
		downSto.each(function() {
			let downId = $(this).attr('id');
			
			$('#'+downId).on('click', function(e) {
				let upBtn = e.target.parentElement.children[2];
				$(upBtn).attr('disabled', false);
			})
		})
	}
	
	/* 재고 체크 */
	function checkCountProd() {
		let sto = $('.qnttinput');
		//let allSto = $('.incressQnt');
		
		sto.each(function() {
			let stoInputId = $(this).attr('id');
			if($('#'+stoInputId).attr('max') == 0) {
				$('#'+stoInputId).val('0');
				$('#'+stoInputId).next().attr('disabled', true);
				$('#'+stoInputId).prev().attr('disabled', true);
				
				let soldData = `<span class="badge bg-success"style="background: transparent !important; border: 1px solid #fbd5ce !important; color: #eb5e28 !important">
								 SOLD OUT</span>`
				$('#soldOut').append(soldData);
			}
			
		});
		
	}
	
	/* 가격 */
	function changeCartPrice() {		
		let price = $('.cartPrice');
		
		price.each(function(){
			priceId = $(this).attr('id');
			// jQuery id 찾을 때 변수 넣어서 찾기
			
			let changePrice = $('#'+priceId).text();
			//console.log(changePrice);
			changePrice = changePrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
			
			changePrice = changePrice + '원';
			$('#'+priceId).text(changePrice);
		});
	}
    
	</script>
</th:block>

</html>