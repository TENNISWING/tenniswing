<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<style>
.boardContainer {
	margin-bottom: -16px;
}

.toggleBoardTitle {
	cursor: pointer;
}

.boardBody {
	height: 0;
	overflow: hidden;
	transition: all 1s;
}

/* #btn-all-close {
	margin-bottom: 10px;
	background-color: #726996;
	border: none;
	color: #fff;
	cursor: pointer;
	padding: 10px 25px;
	float: right;
}

#btn-all-close:hover {
	background-color: yellow;
	color: #000;
	transition: all 0.35s;
} */
.boardBody.active {
  display: block;
  /* 높이를 정해줘야지만 transition이 적용됨 fit-content */
  height: 800px ;
  
}

</style>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<th:block layout:fragment="content">
<body>
	<div class="content__body">
		<section class="archive-category">
			<div class="col-12">
				<div class="filter__area" style="margin: 0;">
					<div class="email-fixed-search col-6 ">
						<div class="form-group position-relative  mb-0 has-icon-left">
							<button class="btn btn-outline-success" id="clubPostWrite" th:data-club-no="${club.clubNo}"
									data-bs-toggle="modal" data-bs-target="#WriteModal">글쓰기</button>
						</div>
					</div>
					<div class="shortBy-select select__style d-lg-flex d-none">
						<label for="sortBy2">Sort by:</label> <select name="sortBy"
							id="sortBy2">
							<option value="0">조회순</option>
							<option value="0">인기순</option>
							<option value="0">이름순</option>
						</select>
					</div>
				</div>
			</div>
		</section>
	</div>
	<!-- table hover -->
	<div class="table-responsive">
		<table class="table mb-0">
			<thead>
				<tr>
					<th>작성일</th>
					<th>제목</th>
					<th>작성자</th>
					<th>조회수</th>
					<th></th>
				</tr>
			</thead>
			<tbody id="postList">
				<!--  <tr class="toggleBoard" style="height: 70px;">
				 	
					<td>1</td>
					<td>
						<div class="boardContainer">
							<p class="toggleBoardTitle">이것은 자유게시판 제목1</p>
						</div>
					</td>
					<td>user kim</td>
					<td>2023-11-24</td>
					<td>6</td>
				</tr> -->
				<!-- 게시글 상세보기 토글  -->
				 <tr class="toggleBoard">
					<td colspan='5' style="padding: 0;">
						<div class="boardBody" style="text-align: center;">
							<div>
								<img src="./assets/img/card.jpg" style="width: 90%; padding:25px 0px">
							</div>
							<p class="form-control"
									  id="exampleFormControlTextarea1" >게시글 상세내용 들어가는 곳이라구요</p>

							<div class="input-group mb-3">
								<input type="text" class="form-control"
									placeholder="enter your comment"
									aria-label="Recipient's username"
									aria-describedby="basic-addon2" id="replyContents">
								<button type="button" class="input-group-text" id="repSubmit">등록</button>
							</div>
							<div class="table-responsive">
									<table class="table" id="table1">
										<thead>
											<tr>
												<th>작성자</th>
												<th>댓글 내용</th>
												<th>작성일자</th>
												<th></th>
											</tr>
										</thead>
										<tbody id="replyList">
											
										</tbody>

									</table>

								</div>
							<p>여기는 댓글</p>
						</div>
					</td>
				</tr> 
			</tbody>
		</table>

		<br>
		<ul class="pagination justify-content-center">
			<li class="page-item disabled"><a class="page-link" href="#"
				tabindex="-1" aria-disabled="true">이전</a></li>
			<li class="page-item"><a class="page-link" href="#">1</a></li>
			<li class="page-item"><a class="page-link" href="#">2</a></li>
			<li class="page-item"><a class="page-link" href="#">3</a></li>
			<li class="page-item"><a class="page-link" href="#">다음</a></li>
		</ul>
	</div>
	
	<!-- 글작성 모달  -->
	<div class="modal fade text-left" id="WriteModal" tabindex="-1"
		role="dialog" aria-labelledby="myModalLabel33" aria-hidden="true">
		<div
			class="modal-dialog modal-dialog-centered modal-dialog-scrollable"
			role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title" id="myModalLabel33">게시글 작성하기</h4>
					<button type="button" class="close" data-bs-dismiss="modal"
						aria-label="Close">
						<i data-feather="x"></i>
					</button>
				</div>
				<form class="form__wrapper clubPostModal"  id="postForm" th:action="@{/postInsert}" 
					  method="POST" th:object="${club}" enctype="multipart/form-data" data-parsley-validate>
					<div class="modal-body">
						<input type="hidden" name="clubNo" th:value="${club.clubNo}">
						<input type="hidden" name="memId" th:value="${club.memId}">
						<div class="input-group mb-3">
							<input type="file" class="form-control" id="inputGroupFile01"
								style="padding: 0.375rem 0.75rem">
						</div>
						<div class="form-group">
							<label for=clubPostTitle>제목</label>
							<textarea name="clubPostTitle" cols="30" rows="1" id="clubPostTitle"
								class="form-control form-area" placeholder="제목을 입력하세요."></textarea>
						</div>
						<div class="form-group">
							<label for="clubPostCtt">내용</label>
							<textarea name="clubPostCtt" cols="30" rows="5" id="clubPostCtt"
								class="form-control form-area" placeholder="내용을 입력하세요."></textarea>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-light-secondary cancleBtn" data-bs-dismiss="modal">
							<i class="bx bx-x d-block d-sm-none"></i> <span
								class="d-none d-sm-block">취소</span>
						</button>
						<button type="button" class="btn btn-primary ms-1 insertBtn" data-bs-dismiss="modal">
							<i class="bx bx-check d-block d-sm-none"></i> <span
								class="d-none d-sm-block">작성</span>
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- /글작성 모달  -->
	<script>
	
	 	/* // 게시글 콜랩스 토글
	 	document.querySelector(".boardContainer").addEventListener('click',
				function() {
					const toggleAnswer = document.querySelector(".boardBody")
					console.log(toggleAnswer);
					toggleAnswer.classList.toggle('active');
				})   */
		
				
		//게시글 등록
		//글쓰기 버튼 클릭했을때 클럽넘버 값 가지고가기
		$('#WriteModal').on('show.bs.modal', function (e) {
			
			let clubNo = $(e.relatedTarget).attr('data-club-no');
			
			$('.insertBtn').on("click", function(e) {
				console.log('작성 버튼 누르라구요');
				var PostData = $("#postForm").serialize() ;
				
				$.ajax({
					url : 'postInsert',
					data : PostData,
					type : 'post',
					datatype : 'text',
					success : function(result) {
						alert("등록성공")
						postListAjax(); //등록후 리스트 불러오기
						$('#postForm')[0].reset();	//폼값 초기화
						
					},
					error : function() {
						alert("등록 실패")

					}

				})
			});
	 	
		});
	 	
	 	//게시글 전체 조회
	 	function postListAjax(){
	 		let clubNo = $('#clubPostWrite').attr('data-club-no');
	 		console.log("자유게시판에서 클럽번호"+clubNo)
	 		$.ajax({
	 			type: 'GET',
				url: 'postList',
				data: {clubNo},
				success: function (data) {
					$('#postList').empty();
					//console.log("리스트성공!")
					//console.log(data);	
					 for(let [index, clubPost] of data.entries()){
						let List = `
							<tr class="toggleBoard" style="height: 70px;">
								<td>${new Date(clubPost.clubPostWriteDate).toLocaleDateString()}</td>
								<td>
									<div class="boardContainer">
										<p class="toggleBoardTitle">${clubPost.clubPostTitle}</p>
								    </div>
								</td>
								<td>${clubPost.name}</td>
								<td>${clubPost.clubPostHit}</td>
								<td><i type="button" class="fa-regular fa-trash-can postDelBtn"></i></td>
							</tr>
							`
						$('#postList').append(List)
					}
					 document.querySelector(".boardContainer").addEventListener('click',
								function() {
									const toggleAnswer = document.querySelector(".boardBody")
									console.log("토글앤서가 뭐지요"+toggleAnswer);
									//toggleAnswer.classList.toggle('active');
								})  
				
				}
			})
	 	}
		
	 	$(document).ready(function(){
	 		postListAjax()
	 		
	 		
		})
	 	
		
	</script>




</body>
</th:block>
</html>