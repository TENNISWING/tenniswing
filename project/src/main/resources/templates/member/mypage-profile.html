<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layouts/main-layout}">

<th:block layout:fragment="content">
	<h3 class="container p-3">마이 프로필</h3>
	<div class="container" id="mypage">
		<div class="row">
			<div class="col-lg-4 col-md-auto">
				<div th:replace="/member/mypage-sidemenu :: sidemenu"></div>
			</div>
			<div class="col-lg-8 col-md-auto">

				<div class="dashboard-block__title">
					<h4>회원정보</h4>
				</div>
				<div class="container">

					<div class="d-flex justify-content-between p-3">
						<div
							class="col-4 d-flex justify-content-between p-3 bg-light-subtle me-1 fw-semibold rounded-3">
							<div>매치횟수</div>
							<div>0</div>
						</div>
						<div
							class="col-4 d-flex justify-content-between p-3 bg-light-subtle mx-1 fw-semibold rounded-3">
							<div>스마일카드</div>
							<div>0</div>
						</div>
						<div
							class="col-4 d-flex justify-content-between p-3 bg-light-subtle ms-1 fw-semibold rounded-3">
							<div>레드카드</div>
							<div>0</div>
						</div>
					</div>
				</div>



				<form class="form form-vertical form-padding mb-5"
					action="profileUpdate" method="POST" enctype="multipart/form-data" id="updateForm">
					<div class="form-body">
						<input type="text" id="message" hidden="true"
							th:value="${message}">
					</div>

					<div class="justify-content-center">
						<div class="row justify-content-center" id="memberForm">
							<div class="text-start mb-5">
								<div class="text-center ">						

									<img th:src="${member.attachPath}" class="rounded-circle"
										style="width: 15rem;">
									<h5>
										<button type="button" class="btn btn-success btn-sm my-1"
											id="profileBtn" href="javascript:void(0)"
											data-bs-toggle="modal" data-bs-target="#profileImg">사진변경</button>
									</h5>
								</div>
								<div class="modal fade" id="profileImg" tabindex="-1"
									role="dialog" aria-labelledby="exampleModalCenterTitle"
									aria-hidden="true">
									<div
										class="modal-dialog modal-dialog-centered modal-dialog-centered"
										role="document">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title" id="exampleModalCenterTitle">프로필
													사진</h5>
												<button type="button" class="close" data-bs-dismiss="modal"
													aria-label="Close">
													<i data-feather="x"></i>
												</button>
											</div>
											<div class="modal-body">
												<input type="file" class="image-preview-filepond" id="files"
													name="files" multiple>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-info ms-1"
													 id="filesBtn">
													<i class="bx bx-check d-block d-sm-none"></i> <span
														class="d-none d-sm-block">저장하기</span>
												</button>
												<button type="button" class="btn btn-primary ms-1"
													data-bs-dismiss="modal">
													<i class="bx bx-check d-block d-sm-none"></i> <span
														class="d-none d-sm-block">닫기</span>
												</button>
											</div>
										</div>
									</div>
								</div>

								<label for="memId">아이디(이메일)</label><br>
								<div class="input-group mb-3">
									<input type="text" class="form-control" id="memId" name="memId"
										readonly th:value="${member.memId}">

									<div class="invalid-feedback" id="memIdFeedback"></div>
									<input type="checkbox" id="idck" hidden="true">
								</div>

								<div class="col-8">
									<label for="pwd">비밀번호</label><br>
									<div class="input-group mb-3">
										<input type="password" class="form-control"
											placeholder="비밀번호 8자리이상" aria-describedby=pwview id="pwd"
											name="pwd" pattern=".{8,50}" title="최소8자리입력해주세요" required>
										<button class="btn btn-success" type="button" id="pwview">
											<i class="fa-regular fa-eye-slash"></i>
										</button>
									</div>
									<label for="pwd">비밀번호 변경</label><br>
									<div class="input-group mb-3">
										<input type="password" class="form-control"
											placeholder="비밀번호변경을 원하시면 입력해주세요" aria-describedby=pwview id="pwdUpdate"
											name="pwdUpdate" pattern=".{8,50}" title="최소8자리입력해주세요">
										<button class="btn btn-success" type="button" id="pwview1">
											<i class="fa-regular fa-eye-slash"></i>
										</button>
									</div>
								</div>
								<div class="row">
									<div class="col-5">
										<label for="name">이름</label><br>
										<div class="input-group mb-3">
											<input type="text" class="form-control"
												placeholder="한글만 입력 가능" id="name" name="name" required
												th:value="${member.name}">
										</div>
									</div>
									<div class="col-7">
										<label for="phoneNo">휴대폰 번호</label><br>
										<div class="input-group mb-3">
											<input type="text" class="form-control"
												placeholder="숫자만 입력 해주세요" aria-describedby="phoneNoBtn"
												id="phoneNo" name="phoneNo" maxlength="11" required
												th:value="${member.phoneNo}">
											<button class="btn btn-success" type="button" id="phoneNoBtn">인증하기</button>
										</div>
									</div>
								</div>
								<div class="col-6">
									<label for="nick">닉네임</label><br>
									<div class="input-group mb-3">
										<input type="text" class="form-control" placeholder="닉네임입력"
											id="nick" name="nick" maxlength="20" required
											th:value="${member.nick}">
									</div>
								</div>
								<div class="row">
									<div class="col-6">
										<label for="region">지역</label><br>
										<div class="form-group">
											<select class="choices form-select" name="region" id="region"
												th:field="${member.region}">
												<optgroup label="지역">
													<option value="b1">서울</option>
													<option value="b2">인천</option>
													<option value="b3">경기도</option>
													<option value="b4">강원도</option>
													<option value="b5">충청도</option>
													<option value="b6">전라도</option>
													<option value="b7">경상도</option>
													<option value="b8">제주도</option>
												</optgroup>
											</select>
										</div>
									</div>
									<div class="col-6">
										<label for="age">연령대</label><br>
										<div class="form-group">
											<select class="choices form-select" name="age" id="age"
												th:field="${member.age}">
												<optgroup label="연령대">
													<option value="a1">10대</option>
													<option value="a2">20대</option>
													<option value="a3">30대</option>
													<option value="a4">40대</option>
													<option value="a5">50대</option>
													<option value="a6">60대이상</option>
												</optgroup>
											</select>
										</div>
									</div>
								</div>

								<div class="row">
									<div class="col-6">
										<label for="lv">구력</label><br>
										<div class="form-group">
											<select class="choices form-select" name="lv" id="lv"
												th:field="${member.lv}">
												<optgroup label="구력">
													<option value="d1">입문</option>
													<option value="d2">2~5년</option>
													<option value="d3">5년이상</option>
												</optgroup>
											</select>
										</div>
									</div>
									<div class="col-6">
										<label for="gen">성별</label><br>
										<div class="form-group">
											<select class="choices form-select" name="gen" id="gen"
												th:field="${member.gen}">
												<optgroup label="성별">
													<option value="c1">남성</option>
													<option value="c2">여성</option>
												</optgroup>
											</select>
										</div>
									</div>
								</div>

								<div class="row">
									<div class="col-8">
										<label for="ntrp">ntrp</label><br>
										<div class="form-group">
											<select class="choices form-select" id="ntrp" name="ntrp"
												th:field="${member.ntrp}">
												<optgroup label="ntpr">
													<option value="e1">1.0</option>
													<option value="e2">1.5</option>
													<option value="e3">2.0</option>
													<option value="e4">2.5</option>
													<option value="e5">3.0</option>
													<option value="e6">3.5</option>
													<option value="e7">4.0이상</option>
												</optgroup>
											</select>
										</div>
									</div>


								</div>
								<div class="row">
									<div class="col-6">
										<label for="preferAge">선호 연령대</label><br>
										<div class="form-group">
											<select class="choices form-select" name="preferAge"
												id="preferAge" th:field="${member.preferAge}">
												<optgroup label="연령대">
													<option value="a1">10대</option>
													<option value="a2">20대</option>
													<option value="a3">30대</option>
													<option value="a4">40대</option>
													<option value="a5">50대</option>
													<option value="a6">60대이상</option>
												</optgroup>
											</select>
										</div>
									</div>
									<div class="col-6">
										<label for="preferGameWay">선호 게임 방식</label><br>
										<div class="form-group">
											<select class="choices form-select" name="preferGameWay"
												id="preferGameWay" th:field="${member.preferGameWay}">
												<optgroup label="선호 게임 방식">
													<option value="f1">단식</option>
													<option value="f2">남복</option>
													<option value="f3">여복</option>
													<option value="f4">랠리</option>
													<option value="f5">혼복</option>
												</optgroup>
											</select>
										</div>
									</div>
								</div>
								<div class="row mb-5">
									<div class="col-8">
										<label for="crtroomNo">자주가는코트</label><br>
										<div class="input-group mb-3">
											<input type="text" class="form-control" placeholder="코트 입력"
												aria-describedby="crtroomBtn" id="crtroomNo"
												name="crtroomNo" th:value="${member.crtroomNo}">
											<button class="btn btn-success" type="button" id="crtroomBtn">찾기</button>
										</div>
									</div>
								</div>
								<div class="d-flex justify-content-between">
								<button class="btn btn-success" type="submit">수정하기</button>
								<button class="btn btn-danger" type="button" id="quitBtn">회원 탈퇴</button>
								</div>
							</div>				
						</div>

					</div>


				</form>

			</div>
		</div>
	</div>



	<script>
	//비밀번호 보기
	$(document).ready(function () {
		$("#pwview").on("click", function (e) {
			$("#pwview").toggleClass("active");

			if ($("#pwview").hasClass("active")) {
				$("#pwview > i").attr("class", "fa-regular fa-eye");
				$("#pwd").attr("type", "text");
			} else {
				$("#pwview > i").attr("class", "fa-regular fa-eye-slash");
				$("#pwd").attr("type", "password");
			}
		});
		$("#pwview1").on("click", function (e) {
			$("#pwview1").toggleClass("active");

			if ($("#pwview1").hasClass("active")) {
				$("#pwview1 > i").attr("class", "fa-regular fa-eye");
				$("#pwdUpdate").attr("type", "text");
			} else {
				$("#pwview1 > i").attr("class", "fa-regular fa-eye-slash");
				$("#pwdUpdate").attr("type", "password");
			}
		});
		
		//메세지 토스트 출력
		let msg = $('#message').val();
		if(msg != '프로필을 수정 하였습니다.' && msg != '' && msg != '프로필사진 등록을 완료하였습니다.' ){
			Toast.fire({
				icon: "error",
				title: msg,
			})
		}
		else if(msg != ''){
			Toast.fire({
				icon: "success",
				title: msg,
			})
		}
		
		//레벨값 바꾸기
		$('#level').text('LV '+$('#ntrp option:checked').text());
		
		//프로필 사진 저장
		$('#filesBtn').on('click', function(e){
			let formData = new FormData($('#updateForm')[0]);
			
			$.ajax({
				url : 'profileupload',
				type : 'post',
				data : $('#updateForm').serialize(),
				enctype: 'multipart/form-data',
				contentType: false,
                processData: false,				
				success : function(result){
					alert('전송잘하고옴')
				}
			})
			
		})
			
	});
	</script>


</th:block>

</html>